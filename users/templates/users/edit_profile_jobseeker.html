<!DOCTYPE html>
{% load static %}
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактирование профиля соискателя</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- Подключение jQuery -->
    <link rel="stylesheet" type="text/css" href="{% static 'users/css/edit_profile_jobseeker.css' %}">
</head>
<body>
    <h1>Редактирование профиля соискателя</h1>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- Поля для username, first_name и last_name -->
        <label for="id_username">Имя пользователя</label>
        {{ form.username }}

        <label for="id_first_name">Имя</label>
        {{ form.first_name }}

        <label for="id_last_name">Фамилия</label>
        {{ form.last_name }}

        <!-- Поле для выбора категории -->
        <label for="id_category">Категория</label>
        {{ form.category }}

        <!-- Поле для выбора профессии -->
        <label for="id_profession">Профессия</label>
        {{ form.profession }}

        <label for="id_phone_number">Номер телефона</label>
        {{ form.phone_number }}

        <label for="id_date_of_birth">Дата рождения (текущее значение):</label>
        <span>{{ form.date_of_birth.value|date:"d.m.Y" }}</span>
        <br>
        <!-- Поле для редактирования даты -->
        <input type="date" name="date_of_birth" id="id_date_of_birth" value="{{ form.date_of_birth.value|date:'Y-m-d' }}">
        <!-- Вывод ошибок для даты рождения -->
        {% if form.date_of_birth.errors %}
            <div class="error">
                {% for error in form.date_of_birth.errors %}
                    <p>{{ error }}</p>
                {% endfor %}
            </div>
        {% endif %}


        <!-- Поле для аватара -->
        <label for="id_avatar">Аватарка</label>
        {{ form.avatar }}

        <!-- Текущее значение для статуса -->
        <label for="id_status">Статус (текущее значение):</label>
        <span>{% if form.status.value == True %}Ищу работу{% else %}Не ищу работу{% endif %}</span>
        <br>
        <!-- Поле для выбора статуса -->
        <div class="status-options">
            <label>
                <input type="radio" name="status" value="True" {% if form.status.value == True %}checked{% endif %}> Ищу работу
            </label>
            <label>
                <input type="radio" name="status" value="False" {% if form.status.value == False %}checked{% endif %}> Не ищу работу
            </label>
        </div>

        <button type="submit">Сохранить изменения</button>
    </form>

    <script>
        // Функция для загрузки профессий по категории
        $('#id_category').change(function() {
            var categoryId = $(this).val();

            // Отправка AJAX-запроса для получения профессий по категории
            $.ajax({
                url: "{% url 'load_professions' %}",
                data: {
                    'category_id': categoryId
                },
                success: function(data) {
                    var professionSelect = $('#id_profession');
                    professionSelect.empty();  // Очистка существующих опций

                    // Добавление новой опции по умолчанию
                    professionSelect.append('<option value="">Выберите профессию</option>');

                    // Заполнение выпадающего списка новыми данными
                    $.each(data, function(key, value) {
                        professionSelect.append('<option value="' + value.id + '">' + value.name + '</option>');
                    });
                }
            });
        });
    </script>
</body>
</html>
